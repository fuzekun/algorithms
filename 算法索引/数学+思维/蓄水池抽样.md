# 蓄水池抽样



适用条件

样例太大，没法全部读入内存。



核心思想，每次选择一个数字的时候，都是1/i的概率进行选择。

对于选择K个的来说，每次都是选择k/i的概率。同时从前k个中随机选择一个进行替换。

优化代码就是，t = rand() % i,当i小于等于k的时候进行替换，同时把t - 1作为被替换的下标即可。





模板代码



```java

int[] reservoir = new int[m];

// init, 小于直接放进来
for (int i = 0; i < reservoir.length; i++)
{
    reservoir[i] = dataStream[i];
}

for (int i = m; i < dataStream.length; i++)
{
    // 随机获得一个[0, i]内的随机整数, 类比选择1的时候，此时m = 0,应该选择1个。
    int d = rand.nextInt(i + 1);
    // 如果随机整数落在[0, m-1]范围内，则替换蓄水池中的元素， 如果m == 1的情况下直接是d == 0
    if (d < m)
    {
        reservoir[d] = dataStream[i];
    }
}
```







#### [497. 非重叠矩形中的随机点](https://leetcode.cn/problems/random-point-in-non-overlapping-rectangles/)

考察前缀和 + 二分

如果数据特别大也可以使用这个算法。

下面思考题可以使用这个做。

**就是处理M个文本文件的前缀和，然后取一个随机数，二分定位到是哪一台机器的哪一个数字，从而得到相应的行。**





![image-20220609162914186](D:\blgs\source\imgs\image-20220609162914186.png)

#### [398. 随机数索引](https://leetcode.cn/problems/random-pick-index/)

简单的随机数和mp的应用



#### [382. 链表随机节点](https://leetcode.cn/problems/linked-list-random-node/)

简单随机数



#### [519. 随机翻转矩阵](https://leetcode.cn/problems/random-flip-matrix/)



交换 + hash

把选中的数放在后面，把后面的下标保存在这个位置，就可以实现下回选择这个数字的时候，得到的就是后面的数字的下标。



类似的题目有

- 删除数组中的某一个数字。

- 忘了。







